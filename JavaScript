document.addEventListener('DOMContentLoaded', () => {
    // Javított ID-k (kisbetűs-kötőjeles formátum)
    const addTabBtn = document.getElementById('add-Tab-Btn'); // <- Ez jó a HTML-nek megfelelően
    const tabBar = document.getElementById('tab-Bar');       // <- Ez jó a HTML-nek megfelelően  
    const tabContainer = document.getElementById('tab-Container'); // <- Ez jó a HTML-nek megfelelően
    
    let count = 0;

    addTabBtn.onclick = () => newTab();
    load();

    function newTab(content = '', name = null) {
        const id = ++count;
        const n = name || `Note ${id}`;
        
        // Tab
        const tab = document.createElement('button');
        tab.className = 'tab-button';
        tab.id = `tab-${id}`;
        const tabNameSpan = document.createElement('span');
        tabNameSpan.textContent = n;
        tabNameSpan.setAttribute('contenteditable', 'true'); // <<-- EZ A LÉNYEG
        const tabCloseSpan = document.createElement('span');
        tabCloseSpan.className = 'tab-close';
        tabCloseSpan.textContent = '×';
        tab.appendChild(tabNameSpan);
        tab.appendChild(tabCloseSpan);
        tab.onclick = e => e.target.classList.contains('tab-close') 
            ? confirm('Törlöd?') && del(id) 
            : active(id);
        
        // Content
        const div = document.createElement('div');
        div.className = 'tab-content';
        div.id = `content-${id}`;
        div.innerHTML = `<textarea oninput="save()">${content}</textarea>`;
        
        tabBar.appendChild(tab);
        tabContainer.appendChild(div);
        active(id);
        save();

        const textarea = document.createElement('textarea');
        

    }

    function active(id) {
        document.querySelectorAll('.tab-button, .tab-content').forEach(el => 
            el.classList.remove('active-tab', 'active-content')
        );
        document.getElementById(`tab-${id}`).classList.add('active-tab');
        document.getElementById(`content-${id}`).classList.add('active-content');
    }

    function del(id) {
        document.getElementById(`tab-${id}`).remove();
        document.getElementById(`content-${id}`).remove();
        const remaining = document.querySelector('.tab-button');
        if (remaining) active(remaining.id.split('-')[1]);
        save();
    }

    window.save = () => {
        const tabs = Array.from(document.querySelectorAll('.tab-button')).map(tab => {
            const id = tab.id.split('-')[1];
            return {
                name: tab.querySelector('span').textContent,
                content: document.querySelector(`#content-${id} textarea`).value
            };
        });
        localStorage.setItem('tabs', JSON.stringify(tabs));
    };

    function load() {
        const saved = JSON.parse(localStorage.getItem('tabs') || '[]');
        saved.length ? saved.forEach(t => newTab(t.content, t.name)) : newTab();
    }

    // Menti a tab nevét, tartalmát és aktív állapotát
    tabsData.push({
        id: parseInt(btn.id.split('-')[1]), 
        name: nameSpan ? nameSpan.textContent : 'Jegyzet',
        content: textarea ? textarea.value : '',
        isActive: btn.classList.contains('active-tab')
    });

});



